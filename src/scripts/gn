#!/usr/bin/env bash

## Copy particular file from output of git-status to clipboard.

set -eo pipefail

if [[ $# -gt 1 || ${1-0} -lt 0 ]]; then
    echo "$0" [SKIP_N=0]
    echo
    echo "Looks at the list of files displayed by git-status and "
    echo "after skipping staged changes adn then the first SKIP_N entries "
    echo "after that, will copy the top file to your clipboard."
    exit 1
fi

SCRIPT_DIR="$( cd "$(dirname "${BASH_SOURCE[0]}")" && pwd -P )"

CURRENT_DIR="$PWD"
FILE="$(git status --porcelain |
    sed -n "/^.[^ ]/ p" | # Skip staged changes
    cut -c 4- |
    tail -n +$(( ${1-0} + 1 )) |
    head -n 1 |
    (
        cd "$(git rev-parse --show-toplevel)" &&
        xargs realpath --relative-to="$CURRENT_DIR"
    ) )"
if [[ -n $FILE ]]; then
    "$SCRIPT_DIR/cb" <<< "$FILE"
    echo "Copied \"$FILE\""
else
    echo "No such file."
fi
